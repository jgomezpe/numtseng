<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0, shrink-to-fit=no">
	<meta name="mobile-web-app-capable" content='yes'>
	<meta charset="UTF-8">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Last-Modified" content="0">
	<meta http-equiv="Cache-Control" content="no-cache, mustrevalidate">
	<meta http-equiv="Pragma" content="no-cache">
 	<title>Numtseng: School of Professor Jonatan Gomez.</title>
	<script type='text/javascript' src='https://jgomezpe.github.io/konekti/src/konekti.js'></script> 
</head>

<body>

	<script>
		let RES_URL = "https://jgomezpe.github.io/numtseng/" // Resources are stored in github
		let SERVER_URL = "https://numtseng.com/" // Change this to your server name
		
        Konekti.uses('accordion', 'sidebar','navbar', 'dropdown', 'iframe')

		class KMain extends MainClient{
			constructor(lang, level, i18n){
				super()
				this.page = ''
				this.lang = lang
				this.level = level
				this.i18n = i18n
				this.current = 0
			}

			index(page){
				var x = this
				var i=0
				while(i<x.navigation[x.level].length && x.navigation[x.level][i]!=page) i++
				if( i==x.navigation[x.level].length ) i=-1
				return i
			}

			select(page){
				var x = this
				var i = x.index(page)
				if( x.page != page && i>=0 ){
					x.page = page
					x.current = i

					if(x.navigation.topic[x.navigation[x.level][x.current]] != "*"){	
						Konekti.dom.setURLSearchParam('page',page)
						Konekti.dom.setURLSearchParam('level',x.level)
						Konekti.dom.setURLSearchParam('lang',x.lang)

						Konekti.daemon( function(){ return Konekti.client['vlo'] !== undefined }, function(){
							var vlo = x.navigation.topic[x.navigation[x.level][x.current]]
							if(typeof vlo==="string"){ vlo = {"url":vlo}}
							var url = vlo.url
							if(!url.startsWith("https://")) url = RES_URL + 'vlo/' + x.lang + '/' + url
							if(vlo.params !== undefined){
								var c = '?'
								for( var p in x.i18n[vlo.params] ){
									url += c + p + '=' + x.i18n[vlo.params][p]
									c = '&'
								}
							}
							var btn = Konekti.vc("prev")
							if(x.current>0) btn.className = btn.className.replace(" w3-disabled", "")
							else btn.className += " w3-disabled"
							btn = Konekti.vc("next")
							if(x.current<x.navigation[x.level].length) btn.className = btn.className.replace(" w3-disabled", "")
							else btn.className += " w3-disabled"
							Konekti.client['vlo'].setText(url)
						})						
					}else{ window.open(page+"/index.html?page=home&level="+x.level+"&lang="+x.lang, '_self') }
				}
			}

			language(lang){	if( lang != this.lang ) window.open("index.html?lang="+lang+"&level="+this.level+"&page="+this.page,"_self")	}

			setlevel(level){
				Konekti.client['dd4'].click()
				var x = this
				if( level != x.level ){
					var clevel = x.level
					x.level = level
					level = clevel
					var i = x.index(x.page)
					console.log(i)
					if(i<0){
						i=1
						for(var j=0; j<x.current; j++){
							if(i<x.navigation[x.level].length && x.navigation[x.level][i]==x.navigation[level][j]) i++
						}
						i--
					}
					x.current = i
					x.select(x.navigation[x.level][x.current])
				}
			}

			prev(){ this.select(this.navigation[this.level][this.current-1]) }

			next(){ this.select(this.navigation[this.level][this.current+1]) }
		}

		function KonektiMain(){
			var lang = Konekti.dom.getUserLanguage()
			var level = Konekti.dom.getURLSearchParam('level', 'advanced')
			var page = Konekti.dom.getURLSearchParam('page', 'home')
			var callback = function(json){ 
				if(json===undefined || json===null){
					if(lang!='es'){
						lang = 'es'
						Konekti.resource.JSON(RES_URL+'i18n/'+lang+'/'+level+'.json', callback)
					}else{
						alert('Page not found')
					}	
				}else{
					var client = new KMain(lang, level, json)
					document.title = json.title
					var toc = {'plugin':'toc', 'setup':['tockonekti', json.toc, {'client':'client', 'method':'select'}, {'style':'width:200px;'}]}
					var dd = {'plugin':'toc', 'setup': ['sel_lang', [['en','', "English"], ['es','',"EspaÃ±ol"]],
						{"client":'client', "method":"language"}, {'title':'Selecting language'}]}
					var levels = []
					var i=0
					for(var y in json.navbar.levels){
						levels[i] = [y, '', json.navbar.levels[y]]
						i++
					}
					var ld = {'plugin':'toc', 'setup': ['sel_level', levels,
						{"client":'client', "method":"setlevel"}, {'title':'Selecting level'}]}	
					var btn=[
						{'plugin':'btn', 'setup':["prev","fa-arrow-left", '', {'client':'client'},{'title':json.navbar.left}]},
						{'plugin':'btn', 'setup':["next","fa-arrow-right", '', {'client':'client'},{'title':json.navbar.right}]},
						{'plugin':'dropdown', 'setup':["dd4", "fa-sort-amount-asc", "", ld,{'title':json.navbar.level}]},
						{'plugin':'dropdown', 'setup':["dd3", "fa-language", "", dd,{'title':json.navbar.language}]}
					]
					var title = {'plugin':'header', 'setup':['title','', json.title, 3, {'class':'w3-green w3-center'}]}
					var navbar = {'plugin':'navbar', 'setup':['navbar', btn, '', {'class':'w3-blue-grey'}]}			
					var control = {'plugin':'iframe', 'setup':['vlo', '', {'style':'width:100%;height:fit;'}]}
					var main = {'plugin':'raw', 'setup':['main-content', [title,navbar,control], {'style':'width:100%;height:fit;'}]}
					Konekti.sidebar('root', toc, main, {'style':'width:100%;height:100%;'})	

					Konekti.resource.JSON(RES_URL+'nav.json', function(navigation){
						client.navigation = navigation
						client.select(page)
					})
				}
			}

			Konekti.resource.JSON(RES_URL+'i18n/'+lang+'/'+level+'.json', callback)
			
        }
	</script>
</body>
</html>