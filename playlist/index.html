<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0, shrink-to-fit=no">
	<meta name="mobile-web-app-capable" content='yes'>
	<meta charset="UTF-8">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Last-Modified" content="0">
	<meta http-equiv="Cache-Control" content="no-cache, mustrevalidate">
	<meta http-equiv="Pragma" content="no-cache">
 	<title>Play list of Professor Jonatan Gomez.</title>
	<script type='text/javascript' src='https://jgomezpe.github.io/konekti/src/konekti.js'></script> 
</head>

<body>

	<script>
		let RES_URL = "https://jgomezpe.github.io/numtseng/" // Resources are stored in github
		let SERVER_URL = "https://jgomezpe.github.io/numtseng/" // Change this to your server name
		
        Konekti.uses('accordion', 'sidebar','navbar', 'dropdown', 'iframe')

		class KMain extends MainClient{
			constructor(lang, i18n){
				super()
				this.page = ''
				this.lang = lang
				this.i18n = i18n
                console.log(this.i18n)
				this.current = null
			}

			select(page){
				var x = this
                if( page == '/') window.open(SERVER_URL+"index.html?page=home&lang="+this.lang, '_self') 
				else if( x.page != page ){
					x.page = page
					x.current = x.navigation[page]
                    Konekti.dom.setURLSearchParam('page',page)
                    Konekti.dom.setURLSearchParam('lang',x.lang)

                    Konekti.daemon( function(){ return Konekti.client['vlo'] !== undefined }, function(){
                        var vlo = x.current.vlo 
                        console.log(vlo)
                        if(typeof vlo==="string"){ vlo = {"url":vlo}}
                        var url = vlo.url
                        if(!url.startsWith("https://")) url = RES_URL + 'vlo/' + x.lang + '/' + url
                        if(vlo.params !== undefined){
                            var params = x.i18n[vlo.params]
                            var c = '?'
                            for( var p in params ){
                                url += c + p + '=' + params[p]
                                c = '&'
                            }
                        }
                        Konekti.client['vlo'].setText(url)
                    })						
				}
			}

			language(lang){	if( lang != this.lang ) window.open("index.html?lang="+lang+"&page="+this.page,"_self")	}

			left(){ if( this.current.left !== undefined ) this.select(this.current.left) }

			right(){ if( this.current.right !== undefined) this.select(this.current.right) }

			up(){ if( this.current.up !== undefined ) this.select(this.current.up) }

			down(){ if( this.current.down !== undefined) this.select(this.current.down) }
		}

		function KonektiMain(){
			var lang = Konekti.dom.getUserLanguage()
			var page = Konekti.dom.getURLSearchParam('page', 'home')
			var callback = function(json){ 
				if(json===undefined || json===null){
					if(lang!='es'){
						lang = 'es'
						Konekti.resource.JSON(RES_URL+'playlist/i18n/'+lang+'.json', callback)
					}else{
						alert('Page not found')
					}	
				}else{
					var client = new KMain(lang, json)
					document.title = json.title
					var toc = {'plugin':'toc', 'setup':['tockonekti', json.toc, {'client':'client', 'method':'select'}, {'style':'width:200px;'}]}
					var dd = {'plugin':'toc', 'setup': ['sel_lang', [['en','', "English"], ['es','',"Espa√±ol"]],
						{"client":'client', "method":"language"}, {'title':'Selecting language'}]}
					var btn=[
						{'plugin':'btn', 'setup':["left","fa-arrow-circle-o-left", '', {'client':'client'},{'title':json.navbar.left}]},
						{'plugin':'btn', 'setup':["up","fa-arrow-circle-o-up", '', {'client':'client'},{'title':json.navbar.up}]},
						{'plugin':'btn', 'setup':["down","fa-arrow-circle-o-down", '', {'client':'client'},{'title':json.navbar.down}]},
						{'plugin':'btn', 'setup':["right","fa-arrow-circle-o-right", '', {'client':'client'},{'title':json.navbar.right}]},
						{'plugin':'dropdown', 'setup':["dd3", "fa-language", "", dd,{'title':json.navbar.language}]}
					]
					var title = {'plugin':'header', 'setup':['title','', json.title, 3, {'class':'w3-green w3-center'}]}
					var navbar = {'plugin':'navbar', 'setup':['navbar', btn, '', {'class':'w3-blue-grey'}]}			
					var control = {'plugin':'iframe', 'setup':['vlo', '', {'style':'width:100%;height:fit;'}]}
					var main = {'plugin':'raw', 'setup':['main-content', [title,navbar,control], {'style':'width:100%;height:fit;'}]}
					Konekti.sidebar('body', 'root', toc, main, {'style':'width:100%;height:100%;'})	

					Konekti.resource.JSON(RES_URL+'playlist/nav.json', function(navigation){
						client.navigation = navigation
						client.select(page)
					})
				}
			}

			Konekti.resource.JSON(RES_URL+'playlist/i18n/'+lang+'.json', callback)
			
        }
	</script>
</body>
</html>