<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Numtseng: Escuela de Python</title>
	<script type='text/javascript' src='https://jgomezpe.github.io/konekti/src/konekti.js'></script> 
</head>

<body>
	<script>
		let RES_URL = "https://jgomezpe.github.io/numtseng/" // Resources are stored in github
		let SERVER_URL = "https://jgomezpe.github.io/numtseng/" // Change this to your server name
		
        Konekti.uses('accordion', 'sidebar','navbar', 'dropdown', 'iframe')

		class KMain extends MainClient{
			constructor(lang){
				super()
				this.page = ''
				this.lang = lang
			}

			select(page){
				var x = this
				if( x.page != page ){			
					x.page = page
					Konekti.dom.setURLSearchParam('page',page)
					Konekti.dom.setURLSearchParam('lang',x.lang)

					x.pleft = x.navigation[page].left
					x.pright = x.navigation[page].right
					x.pup = x.navigation[page].up
					x.pdown = x.navigation[page].down
					var url = x.navigation[page].vlo 
					if(!url.startsWith("https://")) url = RES_URL + 'vlo/' + url
					var tout
					function check(){
						if(Konekti.client['vlo'] !== undefined ){
							clearTimeout(tout)
							Konekti.client['vlo'].setText(url)
						}else tout = setTimeout(check, Konekti.TIMER)
					}
				}
			}

			language(lang){
				console.log(lang)
				if( lang != this.lang ) window.open("index.html?lang="+lang+"&page="+this.page,"_self")
			}

			left(){ if( this.pleft !== undefined ) this.select(this.pleft) }

			right(){ if( this.pright !== undefined) this.select(this.pright) }

			up(){
				if(this.pup=='/') window.open(SERVER_URL+"index.html?lang="+this.lang,"_self")
				else if( this.pup !== undefined ) this.select(this.pup)
			}

			down(){ if( this.pdown !== undefined) this.select(this.pdown) }
		}

		function KonektiMain(){
			var lang = Konekti.dom.getUserLanguage()

			var callback = function(json){ 
				if(json===undefined || json===null){
					lang = 'es'
					Konekti.resource.JSON(RES_URL+'python/i18n/'+lang+'.json', callback)
				}else{
					var client = new KMain(lang)
					document.title = json.title
					var toc = {'plugin':'toc', 'setup':['tockonekti', json.toc, {'client':'client', 'method':'select'}, {'style':'width:200px;'}]}
					var dd = {'plugin':'toc', 'setup': ['sel_lang', [['en','', "English"], ['es','',"Espa√±ol"]],
						{"client":'client', "method":"language"}, {'title':'Selecting language'}]}	
					var btn=[
						{'plugin':'btn', 'setup':["left","fa-arrow-circle-o-left", '', {'client':'client'}]},
						{'plugin':'btn', 'setup':["up","fa-arrow-circle-o-up", '', {'client':'client'}]},
						{'plugin':'btn', 'setup':["down","fa-arrow-circle-o-down", '', {'client':'client'}]},
						{'plugin':'btn', 'setup':["right","fa-arrow-circle-o-right", '', {'client':'client'}]},
						{'plugin':'dropdown', 'setup':["dd3", "fa-language", "", dd]}
					]
					var title = {'plugin':'header', 'setup':['title','', json.title, 3, {'class':'w3-green w3-center'}]}
					var navbar = {'plugin':'navbar', 'setup':['navbar', btn, '', {'class':'w3-blue-grey'}]}			
					var control = {'plugin':'iframe', 'setup':['vlo', '', {'style':'width:100%;height:90%;'}]}
					var main = {'plugin':'raw', 'setup':['main-content', [title,navbar,control], {'style':'width:100%;height:100%;'}]}
					Konekti.sidebar('body', 'root', toc, main, {'style':'width:100%;height:100%;'})	

					// Konekti.resize()
					Konekti.resource.JSON(RES_URL+'python/navigation.json', function(navigation){
						client.navigation = navigation
						client.select(Konekti.dom.getURLSearchParam('page', 'home'))
					})
				}
			}

			Konekti.resource.JSON(RES_URL+'python/i18n/'+lang+'.json', callback)
			
        }
	</script>
</body>
</html>
